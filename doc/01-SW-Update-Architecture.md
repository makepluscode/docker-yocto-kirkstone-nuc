# SW Update 시스템 아키텍처

## 개요

이 문서는 SW Update 시스템의 전체 아키텍처를 설명합니다. 본 시스템은 호스트 시스템에서 패키지를 생성하고, 타겟 디바이스에서 안전한 업데이트를 수행하는 OTA(Over-The-Air) 업데이트 솔루션입니다.

![SW Update Architecture](SW%20Update.drawio)

## 시스템 구성 요소

본 SW Update 시스템의 핵심 설계 철학은 **기능 분리(Separation of Concerns)**입니다. 특히 타겟 디바이스에서 **Update Agent는 모든 업데이트 기능을 전담**하고, **System SW는 업데이트 과정에 개입하지 않으며 오직 UI 역할만** 수행합니다.

### 1. 호스트 시스템 (Host)

호스트 시스템은 업데이트 패키지를 생성하고 배포하는 역할을 담당합니다. Windows, Linux, macOS 환경을 지원하며 다음과 같은 주요 구성요소를 포함합니다.

#### 1.1 Package Builder (패키지 빌더)

패키지 빌더는 업데이트 패키지를 생성하는 핵심 구성요소입니다.

- **GUI**: 사용자 친화적인 그래픽 인터페이스를 통한 패키지 생성
- **Package Manager**: 패키지의 생성, 관리, 버전 제어를 담당
- **Package Signaturer**: 패키지의 무결성과 인증을 위한 디지털 서명 생성
- **Key & Cert**: 패키지 서명에 사용되는 인증서와 개인키 관리

**주요 기능**:
- 소프트웨어 패키지 생성 및 압축
- 버전 관리 및 메타데이터 생성
- 디지털 서명을 통한 패키지 인증
- 배포 준비를 위한 패키지 최적화

#### 1.2 Package Updater (패키지 업데이터)

패키지 업데이터는 생성된 패키지를 타겟 디바이스에 전송하고 업데이트 과정을 관리합니다.

- **GUI**: 업데이트 프로세스 모니터링 및 제어 인터페이스
- **User Authenticator**: 업데이트 권한 관리 및 사용자 인증
- **Package Verifier**: 패키지 무결성 검증 및 유효성 확인
- **Update Server**: 업데이트 패키지 배포를 위한 HTTP/HTTPS 서버

**주요 기능**:
- 타겟 디바이스와의 안전한 통신 (HTTPS/Ethernet)
- 사용자 권한 검증 및 인증 관리
- 패키지 전송 전 무결성 검사
- 업데이트 진행상황 모니터링

### 2. 타겟 디바이스 (Target Device)

타겟 디바이스는 실제 업데이트가 수행되는 임베디드 시스템입니다. QNX/Linux 환경을 지원하며, **업데이트 전담 시스템과 일반 시스템이 완전히 분리**된 구조로 되어 있습니다.

#### 2.1 Update Agent (업데이트 에이전트)

**Update Agent는 타겟 디바이스에서 모든 업데이트 관련 기능을 전담하는 독립적이고 완전한 업데이트 시스템입니다.** System SW와는 완전히 분리되어 동작하며, 업데이트의 전 과정을 자체적으로 처리합니다.

- **Update Client**: 호스트 시스템과 통신하여 업데이트 패키지를 수신
- **Package Loader**: 수신된 패키지를 메모리에 로드하고 준비
- **Package Authenticator**: 패키지의 디지털 서명 검증
- **Package Installer**: 실제 패키지 설치 및 시스템 업데이트 수행
- **Status Notifier**: 업데이트 진행상황을 호스트에 실시간 전송
- **A/B Booting Manager**: 안전한 A/B 부팅 시스템 관리
- **File System Manager**: 파일시스템 마운트/언마운트 및 파티션 관리
- **Key & Cert**: 패키지 검증에 사용되는 인증서 저장소

**핵심 특징**:
- **완전 독립적 동작**: System SW에 의존하지 않는 자체 완결적 업데이트 시스템
- **백그라운드 처리**: 사용자 애플리케이션에 영향을 주지 않고 백그라운드에서 동작
- **전담 처리**: 네트워크 통신, 인증, 설치, 부팅 관리 등 모든 업데이트 관련 작업 수행

**주요 기능**:
- HTTPS를 통한 안전한 패키지 다운로드
- 실시간 업데이트 상태 보고
- A/B 파티션을 활용한 무중단 업데이트
- 업데이트 실패 시 자동 롤백 기능
- 패키지 무결성 검증 및 인증
- System SW와의 독립적 동작 보장

#### 2.2 System SW (시스템 소프트웨어)

**System SW는 디바이스의 일반적인 기능을 담당하는 기존 시스템이며, 업데이트 기능과는 완전히 분리되어 있습니다.** 업데이트와 관련해서는 오직 사용자 인터페이스 역할만 수행합니다.

- **System GUI**: 디바이스의 주요 사용자 인터페이스
  - **업데이트 시작 인터페이스**: 사용자가 업데이트를 시작할 수 있는 버튼/메뉴 제공
  - **진행상황 표시**: Update Agent로부터 받은 업데이트 진행률과 상태 정보를 화면에 표시
  - **결과 알림**: 업데이트 완료, 실패, 재시작 필요 등의 결과를 사용자에게 알림
- **일반 시스템 기능**: 업데이트와 무관한 디바이스 본연의 기능들
  - 일반 애플리케이션 실행
  - 시스템 설정 및 관리
  - 하드웨어 제어 및 모니터링

**중요한 특징**:
- **업데이트 기능 비포함**: 실제 업데이트 처리는 전혀 담당하지 않음
- **단순 인터페이스 역할**: Update Agent와 사용자 간의 인터페이스 역할만 수행
- **기존 시스템 유지**: 업데이트 시에도 기본 기능은 정상 동작 유지
- **독립적 동작**: Update Agent의 동작과 독립적으로 시스템 기능 제공

## 통신 프로토콜

### 네트워크 통신

- **프로토콜**: HTTPS (암호화된 HTTP 통신)
- **물리 계층**: Ethernet (이더넷 연결)
- **보안**: SSL/TLS 암호화를 통한 안전한 데이터 전송

### 인증 및 보안

#### 디지털 서명 체계
- **PKI 기반**: 공개키 암호화 방식 사용
- **이중 검증**: 호스트에서 서명 생성, 타겟에서 서명 검증
- **인증서 관리**: 각 시스템의 독립적인 인증서 저장소 운영

#### 통신 보안
- **HTTPS 암호화**: 모든 네트워크 통신은 SSL/TLS 암호화
- **상호 인증**: 호스트와 타겟 간 양방향 인증
- **무결성 검증**: 패키지 전송 전후 해시 검증

## A/B 업데이트 시스템

### A/B 파티션 구조

타겟 디바이스는 A/B 부팅 시스템을 통해 안전한 업데이트를 보장합니다:

1. **A 파티션**: 현재 실행 중인 시스템
2. **B 파티션**: 업데이트 대상 파티션
3. **부트로더**: 부팅 시 활성 파티션 선택

### 업데이트 프로세스

1. **준비 단계**: 비활성 파티션(B) 초기화
2. **다운로드**: 업데이트 패키지를 B 파티션에 설치
3. **검증**: 설치된 시스템의 무결성 검증
4. **전환**: 부트로더 설정 변경으로 B 파티션을 활성화
5. **확인**: 다음 부팅 시 B 파티션으로 시스템 시작
6. **롤백**: 문제 발생 시 A 파티션으로 자동 복구

## 업데이트 워크플로우

### 1. 패키지 생성 단계

```
[개발자] -> [Package Builder] -> [서명된 패키지] -> [Update Server]
```

1. 개발자가 새로운 소프트웨어 버전 개발 완료
2. Package Builder GUI를 통해 패키지 생성 시작
3. Package Manager가 소스코드를 패키징
4. Package Signaturer가 디지털 서명 적용
5. Update Server에 배포 준비 완료

### 2. 업데이트 배포 단계

```
[Update Server] --HTTPS--> [Update Agent] -> [System GUI] (진행상황 표시) -> [시스템 재시작]
```

1. **업데이트 감지**: Update Server가 새 패키지 가용성 알림
2. **사용자 시작**: System GUI를 통해 사용자가 업데이트 시작
3. **Update Agent 독립 수행**: 모든 업데이트 작업을 자체적으로 처리
   - Update Client가 패키지 다운로드
   - Package Authenticator가 패키지 서명 검증
   - Package Installer가 B 파티션에 설치 수행
   - A/B Booting Manager가 부팅 파티션 전환
4. **상태 피드백**: Status Notifier가 System GUI에 진행상황 전달
5. **백그라운드 완료**: System SW의 일반 기능에 영향 없이 독립적 완료

### 3. 안전성 검증 단계

```
[새 시스템 부팅] -> [자체 진단] -> [정상 동작 확인] -> [업데이트 완료]
                                  -> [문제 감지] -> [자동 롤백]
```

1. 새로운 시스템으로 부팅 시도
2. 핵심 시스템 구성요소 자체 진단 수행
3. 정상 동작 시 업데이트 성공으로 표시
4. 문제 감지 시 이전 파티션으로 자동 롤백

## 장점 및 특징

### 안전성
- **A/B 업데이트**: 업데이트 실패 시 자동 롤백
- **디지털 서명**: 패키지 무결성 및 인증 보장
- **암호화 통신**: 네트워크 보안 강화

### 신뢰성
- **실시간 모니터링**: 업데이트 과정의 실시간 상태 추적
- **단계별 검증**: 각 단계마다 무결성 검사 수행
- **오류 복구**: 자동화된 오류 감지 및 복구 메커니즘

### 확장성
- **멀티 플랫폼**: Windows, Linux, macOS 호스트 지원
- **다양한 타겟**: QNX, Linux 타겟 디바이스 지원
- **모듈형 설계**: 각 구성요소의 독립적 확장 가능

### 사용성
- **직관적 GUI**: 사용자 친화적인 그래픽 인터페이스
- **자동화**: 최소한의 사용자 개입으로 업데이트 수행
- **상태 피드백**: 실시간 진행상황 및 결과 보고

## 결론

이 SW Update 시스템은 산업용 임베디드 시스템을 위한 안전하고 신뢰할 수 있는 OTA 업데이트 솔루션을 제공합니다. 특히 **기능의 명확한 분리**를 통해 시스템의 안정성과 유지보수성을 보장합니다.

### 핵심 설계 특징

- **업데이트 기능의 완전 분리**: Update Agent가 모든 업데이트 기능을 독립적으로 체리
- **기존 시스템의 무간섭**: System SW는 업데이트 과정에 개입하지 않고 UI 역할만 수행
- **백그라운드 업데이트**: 사용자 애플리케이션에 영향 없이 독립적 수행
- **A/B 업데이트**: 업데이트 실패 시 자동 롤백으로 시스템 중단 방지
- **강력한 보안**: PKI 기반 디지털 서명과 HTTPS 암호화 통신

이러한 설계를 통해 안전하고 신뢰할 수 있는 업데이트를 보장하며, 직관적인 사용자 인터페이스와 함께 다양한 플랫폼 환경에서 확장 가능한 솔루션을 제공합니다.